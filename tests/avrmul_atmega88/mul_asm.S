/* Copyright (c) 2012, IAIK - TU Graz, mhutter, ewenger
   All rights reserved. Patent pending (PCT/AT 2011/00397).
   
   Redistribution and use in source and binary forms, with or without
   modification, are permitted provided that the following conditions are met:
   
   * Redistributions of source code must retain the above copyright
     notice, this list of conditions and the following disclaimer.
   
   * Redistributions in binary form must reproduce the above copyright
     notice, this list of conditions and the following disclaimer in
     the documentation and/or other materials provided with the
     distribution.
   
   * Neither the name of the copyright holders nor the names of
     contributors may be used to endorse or promote products derived
     from this software without specific prior written permission.
   
   THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
   AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
   IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
   ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE
   LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
   CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
   SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
   INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
   CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
   ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
   POSSIBILITY OF SUCH DAMAGE. */
   
/**
  * asm_mul.S
  * Operand Caching Multiplication (unrolled, e=9) of 160-bit operands on an 8-bit AVR (ATmega128)
  * Clock Cycles : 2396 (2473 cycles with PUSH/POP/RET)
  * null  * Code Size: 3778 bytes
  */   
   
  .global mul_asm
  .type mul_asm, @function
  
; operand b: r21:r20
; operand a: r23:r22
; operand r: r25:r24
  
mul_asm:
  
  PUSH R2 
  PUSH R3 
  PUSH R4 
  PUSH R5 
  PUSH R6 
  PUSH R7 
  PUSH R8 
  PUSH R9 
  PUSH R10
  PUSH R11
  PUSH R12
  PUSH R13
  PUSH R14
  PUSH R15
  PUSH R16
  PUSH R17
  PUSH R28
  PUSH R29
  
  ;Z<-r
  MOVW R30, R24
  ;Y<-b
  MOVW R28, R20
  ;X<-a
  MOVW R26, R22
  
; clear zero register and accumulator
  CLR R22
  CLR R23
  CLR R24
  CLR R25
; ___________________________________________________________
; PHASE 1, k: 1
  ADIW R26, 10
  LD R2, X+
  LD R3, X+
  LD R4, X+
  LD R5, X+
  LD R6, X+
  LD R7, X+
  LD R8, X+
  LD R9, X+
  LD R10, X+
  LD R11, X+
  LD R12, Y+
  LD R13, Y+
  LD R14, Y+
  LD R15, Y+
  LD R16, Y+
  LD R17, Y+
  LD R18, Y+
  LD R19, Y+
  LD R20, Y+
  LD R21, Y+
  
  ADIW R30, 10
  MUL R2, R12
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  ST Z+, R23
  CLR R23
  
  MUL R2, R13
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R3, R12
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  ST Z+, R24
  CLR R24
  
  MUL R2, R14
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R3, R13
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R4, R12
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  ST Z+, R25
  CLR R25
  
  MUL R2, R15
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R3, R14
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R4, R13
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R5, R12
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  ST Z+, R23
  CLR R23
  
  MUL R2, R16
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R3, R15
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R4, R14
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R5, R13
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R6, R12
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  ST Z+, R24
  CLR R24
  
  MUL R2, R17
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R3, R16
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R4, R15
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R5, R14
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R6, R13
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R7, R12
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  ST Z+, R25
  CLR R25
  
  MUL R2, R18
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R3, R17
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R4, R16
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R5, R15
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R6, R14
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R7, R13
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R8, R12
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  ST Z+, R23
  CLR R23
  
  MUL R2, R19
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R3, R18
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R4, R17
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R5, R16
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R6, R15
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R7, R14
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R8, R13
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R9, R12
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  ST Z+, R24
  CLR R24
  
  MUL R2, R20
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R3, R19
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R4, R18
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R5, R17
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R6, R16
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R7, R15
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R8, R14
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R9, R13
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R10, R12
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  ST Z+, R25
  CLR R25
  
  MUL R2, R21
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R3, R20
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R4, R19
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R5, R18
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R6, R17
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R7, R16
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R8, R15
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R9, R14
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R10, R13
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R11, R12
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  ST Z+, R23
  CLR R23
  
; PHASE 2, k: 1
; PHASE 3, k: 1
; PHASE 4, k: 1
  MUL R3, R21
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R4, R20
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R5, R19
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R6, R18
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R7, R17
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R8, R16
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R9, R15
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R10, R14
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R11, R13
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  ST Z+, R24
  CLR R24
  
  MUL R4, R21
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R5, R20
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R6, R19
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R7, R18
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R8, R17
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R9, R16
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R10, R15
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R11, R14
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  ST Z+, R25
  CLR R25
  
  MUL R5, R21
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R6, R20
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R7, R19
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R8, R18
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R9, R17
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R10, R16
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R11, R15
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  ST Z+, R23
  CLR R23
  
  MUL R6, R21
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R7, R20
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R8, R19
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R9, R18
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R10, R17
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R11, R16
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  ST Z+, R24
  CLR R24
  
  MUL R7, R21
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R8, R20
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R9, R19
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R10, R18
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R11, R17
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  ST Z+, R25
  CLR R25
  
  MUL R8, R21
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R9, R20
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R10, R19
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R11, R18
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  ST Z+, R23
  CLR R23
  
  MUL R9, R21
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R10, R20
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R11, R19
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  ST Z+, R24
  CLR R24
  
  MUL R10, R21
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R11, R20
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  ST Z+, R25
  CLR R25
  
  MUL R11, R21
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  ST Z+, R23
  CLR R23
  
  ST Z+, R24
  CLR R24
; reset x,y,z pointers
  SBIW R26, 20
  SBIW R28, 10
  SBIW R30, 30
  
; ___________________________________________________________
; PHASE 1, k: 0
  LD R2, X+
  LD R3, X+
  LD R4, X+
  LD R5, X+
  LD R6, X+
  LD R7, X+
  LD R8, X+
  LD R9, X+
  LD R10, X+
  LD R11, X+
  LD R12, Y+
  LD R13, Y+
  LD R14, Y+
  LD R15, Y+
  LD R16, Y+
  LD R17, Y+
  LD R18, Y+
  LD R19, Y+
  LD R20, Y+
  LD R21, Y+
  
  MUL R2, R12
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  ST Z+, R25
  CLR R25
  
  MUL R2, R13
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R3, R12
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  ST Z+, R23
  CLR R23
  
  MUL R2, R14
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R3, R13
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R4, R12
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  ST Z+, R24
  CLR R24
  
  MUL R2, R15
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R3, R14
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R4, R13
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R5, R12
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  ST Z+, R25
  CLR R25
  
  MUL R2, R16
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R3, R15
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R4, R14
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R5, R13
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R6, R12
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  ST Z+, R23
  CLR R23
  
  MUL R2, R17
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R3, R16
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R4, R15
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R5, R14
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R6, R13
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R7, R12
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  ST Z+, R24
  CLR R24
  
  MUL R2, R18
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R3, R17
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R4, R16
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R5, R15
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R6, R14
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R7, R13
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R8, R12
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  ST Z+, R25
  CLR R25
  
  MUL R2, R19
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R3, R18
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R4, R17
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R5, R16
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R6, R15
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R7, R14
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R8, R13
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R9, R12
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  ST Z+, R23
  CLR R23
  
  MUL R2, R20
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R3, R19
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R4, R18
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R5, R17
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R6, R16
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R7, R15
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R8, R14
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R9, R13
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R10, R12
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  ST Z+, R24
  CLR R24
  
  MUL R2, R21
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R3, R20
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R4, R19
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R5, R18
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R6, R17
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R7, R16
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R8, R15
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R9, R14
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R10, R13
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R11, R12
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  ST Z+, R25
  CLR R25
  
; PHASE 2, k: 0
  LD R12, Z
  ADD R23, R12
  ADC R24, R22
  LD R12, Y+
  MUL R2, R12
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R3, R21
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R4, R20
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R5, R19
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R6, R18
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R7, R17
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R8, R16
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R9, R15
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R10, R14
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R11, R13
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  ST Z+, R23
  CLR R23
  
  LD R13, Z
  ADD R24, R13
  ADC R25, R22
  LD R13, Y+
  MUL R2, R13
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R3, R12
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R4, R21
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R5, R20
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R6, R19
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R7, R18
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R8, R17
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R9, R16
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R10, R15
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R11, R14
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  ST Z+, R24
  CLR R24
  
  LD R14, Z
  ADD R25, R14
  ADC R23, R22
  LD R14, Y+
  MUL R2, R14
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R3, R13
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R4, R12
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R5, R21
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R6, R20
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R7, R19
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R8, R18
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R9, R17
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R10, R16
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R11, R15
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  ST Z+, R25
  CLR R25
  
  LD R15, Z
  ADD R23, R15
  ADC R24, R22
  LD R15, Y+
  MUL R2, R15
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R3, R14
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R4, R13
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R5, R12
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R6, R21
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R7, R20
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R8, R19
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R9, R18
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R10, R17
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R11, R16
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  ST Z+, R23
  CLR R23
  
  LD R16, Z
  ADD R24, R16
  ADC R25, R22
  LD R16, Y+
  MUL R2, R16
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R3, R15
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R4, R14
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R5, R13
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R6, R12
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R7, R21
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R8, R20
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R9, R19
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R10, R18
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R11, R17
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  ST Z+, R24
  CLR R24
  
  LD R17, Z
  ADD R25, R17
  ADC R23, R22
  LD R17, Y+
  MUL R2, R17
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R3, R16
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R4, R15
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R5, R14
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R6, R13
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R7, R12
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R8, R21
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R9, R20
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R10, R19
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R11, R18
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  ST Z+, R25
  CLR R25
  
  LD R18, Z
  ADD R23, R18
  ADC R24, R22
  LD R18, Y+
  MUL R2, R18
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R3, R17
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R4, R16
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R5, R15
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R6, R14
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R7, R13
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R8, R12
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R9, R21
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R10, R20
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R11, R19
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  ST Z+, R23
  CLR R23
  
  LD R19, Z
  ADD R24, R19
  ADC R25, R22
  LD R19, Y+
  MUL R2, R19
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R3, R18
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R4, R17
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R5, R16
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R6, R15
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R7, R14
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R8, R13
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R9, R12
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R10, R21
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R11, R20
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  ST Z+, R24
  CLR R24
  
  LD R20, Z
  ADD R25, R20
  ADC R23, R22
  LD R20, Y+
  MUL R2, R20
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R3, R19
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R4, R18
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R5, R17
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R6, R16
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R7, R15
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R8, R14
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R9, R13
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R10, R12
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R11, R21
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  ST Z+, R25
  CLR R25
  
  LD R21, Z
  ADD R23, R21
  ADC R24, R22
  LD R21, Y+
  MUL R2, R21
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R3, R20
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R4, R19
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R5, R18
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R6, R17
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R7, R16
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R8, R15
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R9, R14
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R10, R13
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R11, R12
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  ST Z+, R23
  CLR R23
  
; PHASE 3, k: 0
  LD R2, Z
  ADD R24, R2
  ADC R25, R22
  LD R2, X+
  MUL R3, R21
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R4, R20
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R5, R19
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R6, R18
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R7, R17
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R8, R16
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R9, R15
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R10, R14
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R11, R13
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R2, R12
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  ST Z+, R24
  CLR R24
  
  LD R3, Z
  ADD R25, R3
  ADC R23, R22
  LD R3, X+
  MUL R4, R21
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R5, R20
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R6, R19
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R7, R18
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R8, R17
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R9, R16
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R10, R15
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R11, R14
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R2, R13
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R3, R12
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  ST Z+, R25
  CLR R25
  
  LD R4, Z
  ADD R23, R4
  ADC R24, R22
  LD R4, X+
  MUL R5, R21
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R6, R20
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R7, R19
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R8, R18
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R9, R17
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R10, R16
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R11, R15
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R2, R14
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R3, R13
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R4, R12
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  ST Z+, R23
  CLR R23
  
  LD R5, Z
  ADD R24, R5
  ADC R25, R22
  LD R5, X+
  MUL R6, R21
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R7, R20
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R8, R19
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R9, R18
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R10, R17
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R11, R16
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R2, R15
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R3, R14
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R4, R13
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R5, R12
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  ST Z+, R24
  CLR R24
  
  LD R6, Z
  ADD R25, R6
  ADC R23, R22
  LD R6, X+
  MUL R7, R21
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R8, R20
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R9, R19
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R10, R18
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R11, R17
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R2, R16
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R3, R15
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R4, R14
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R5, R13
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R6, R12
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  ST Z+, R25
  CLR R25
  
  LD R7, Z
  ADD R23, R7
  ADC R24, R22
  LD R7, X+
  MUL R8, R21
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R9, R20
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R10, R19
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R11, R18
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R2, R17
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R3, R16
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R4, R15
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R5, R14
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R6, R13
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R7, R12
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  ST Z+, R23
  CLR R23
  
  LD R8, Z
  ADD R24, R8
  ADC R25, R22
  LD R8, X+
  MUL R9, R21
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R10, R20
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R11, R19
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R2, R18
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R3, R17
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R4, R16
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R5, R15
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R6, R14
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R7, R13
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R8, R12
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  ST Z+, R24
  CLR R24
  
  LD R9, Z
  ADD R25, R9
  ADC R23, R22
  LD R9, X+
  MUL R10, R21
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R11, R20
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R2, R19
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R3, R18
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R4, R17
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R5, R16
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R6, R15
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R7, R14
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R8, R13
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R9, R12
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  ST Z+, R25
  CLR R25
  
  LD R10, Z
  ADD R23, R10
  ADC R24, R22
  LD R10, X+
  MUL R11, R21
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R2, R20
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R3, R19
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R4, R18
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R5, R17
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R6, R16
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R7, R15
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R8, R14
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R9, R13
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R10, R12
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  ST Z+, R23
  CLR R23
  
  LD R11, Z
  ADD R24, R11
  ADC R25, R22
  LD R11, X+
  MUL R2, R21
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R3, R20
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R4, R19
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R5, R18
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R6, R17
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R7, R16
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R8, R15
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R9, R14
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R10, R13
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R11, R12
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  ST Z+, R24
  CLR R24
  
; PHASE 4, k: 0
  MUL R3, R21
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R4, R20
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R5, R19
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R6, R18
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R7, R17
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R8, R16
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R9, R15
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R10, R14
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R11, R13
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  ST Z+, R25
  CLR R25
  
  MUL R4, R21
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R5, R20
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R6, R19
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R7, R18
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R8, R17
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R9, R16
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R10, R15
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R11, R14
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  ST Z+, R23
  CLR R23
  
  MUL R5, R21
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R6, R20
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R7, R19
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R8, R18
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R9, R17
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R10, R16
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R11, R15
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  ST Z+, R24
  CLR R24
  
  MUL R6, R21
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R7, R20
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R8, R19
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R9, R18
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R10, R17
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R11, R16
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  ST Z+, R25
  CLR R25
  
  MUL R7, R21
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R8, R20
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R9, R19
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R10, R18
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R11, R17
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  ST Z+, R23
  CLR R23
  
  MUL R8, R21
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R9, R20
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R10, R19
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  MUL R11, R18
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  ST Z+, R24
  CLR R24
  
  MUL R9, R21
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R10, R20
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  MUL R11, R19
  ADD R25, R0
  ADC R23, R1
  ADC R24, R22
  ST Z+, R25
  CLR R25
  
  MUL R10, R21
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  MUL R11, R20
  ADD R23, R0
  ADC R24, R1
  ADC R25, R22
  ST Z+, R23
  CLR R23
  
  MUL R11, R21
  ADD R24, R0
  ADC R25, R1
  ADC R23, R22
  ST Z+, R24
  CLR R24
  
  ST Z+, R25
  CLR R1
  POP R29
  POP R28
  POP R17
  POP R16
  POP R15
  POP R14
  POP R13
  POP R12
  POP R11
  POP R10
  POP R9 
  POP R8 
  POP R7 
  POP R6 
  POP R5 
  POP R4 
  POP R3 
  POP R2 
  RET
  

